# リアルタイム声質変換システム

このシステムは、マイクから入力された音声をリアルタイムでサーバーに送信し、AIモデルによる声質変換を行った後、クライアントに返送して再生するシステムです。

## 1. 必要なもの (Prerequisites)

### サーバー側 (ホストPC - Ubuntu)
- Docker
- NVIDIA GPU と対応するドライバ
- Python 3.11+
- プロジェクトファイル一式

### クライアント側 (Windows)
- Python 3.11+
- **PyAudio:** `pip install pyaudio`
- **(推奨) VB-CABLE:** 仮想オーディオデバイス
- **(推奨) OBS Studio:** ノイズ除去フィルタの適用

## 2. セットアップ (Setup)

### サーバー側 (Ubuntu/Docker)

1.  **Dockerイメージのビルド:**
    プロジェクトのルートディレクトリ (`ZVRVC`) で、以下のコマンドを実行してDockerイメージをビルドします。
    ```bash
    docker build -t zvrvc .
    ```

### クライアント側 (Windows)

1.  **Pythonパッケージのインストール:**
    コマンドプロンプトやPowerShellで、`PyAudio`をインストールします。
    ```bash
    pip install pyaudio
    ```

2.  **(推奨) ノイズ除去のためのOBS & VB-CABLE設定:**
    よりクリアな音声をサーバーに送るため、OBSのノイズ除去フィルタを利用することを強く推奨します。

    a. **VB-CABLEのインストール:** 公式サイトからダウンロードし、インストールします。
    
    b. **OBSの設定:**
        i. **ソース追加:** 「ソース」パネルで「+」→「音声入力キャプチャ」を選択し、お使いの物理マイクを指定します。
        ii. **フィルタ追加:** 「音声ミキサー」でマイクのフィルタ設定を開き、「+」から「ノイズ抑制」を追加します。（RNNoise推奨）
        iii. **モニタリング設定:** OBSの「設定」→「音声」→「詳細設定」にある「モニタリングデバイス」を「**CABLE Input (VB-Audio Virtual Cable)**」に設定します。
        iv. **モニタリング有効化:** 「音声ミキサー」の「オーディオの詳細プロパティ」で、マイクの「音声モニタリング」を「**モニターのみ（出力はミュート）**」に設定します。

## 3. 実行方法 (Usage)

#### ステップ1: サーバーを起動する (Ubuntu)

ホストPCのターミナルで、プロジェクトのルートディレクトリに移動し、以下のコマンドでDockerコンテナを起動します。

```bash
docker run --gpus all -it --rm --name zvrvc -p 8080:8080 -v ./:/app -w /app zvrvc
```

コンテナ内でサーバを起動します。
```bash
python server.py
```

ターミナルに`サーバーが 0.0.0.0:8080 で待機中です。`と表示されれば準備完了です。

#### ステップ2: クライアントの準備 (Windows)

1.  **(推奨) OBSを起動:** ノイズ除去を行う場合は、OBSを起動したままにします。\
（以下は自宅など大学環境外から接続する場合、必要な手順です。）
2.  **VS Codeでホストに接続:** クライアントPCでVS Codeを起動し、ホストPC（Ubuntu）にSSH接続します。
3.  **ポートフォワーディングを設定:** VS Code下部の「ポート」タブを開き、「ポートを転送」ボタンから`8080`番ポートを転送します。

#### ステップ3: クライアントスクリプトを実行する (Windows)

1.  **使用するデバイスの番号を確認:**
    まず、以下のコマンドで利用可能な音声デバイスの一覧とインデックス番号を確認します。
    ```bash
    python client.py --list-devices
    ```
    * **ノイズ除去ありの場合:** 入力デバイスとして`CABLE Output (VB-Audio Virtual Cable)`のインデックス番号を探します。
    * **ノイズ除去なしの場合:** 入力デバイスとしてお使いの物理マイクのインデックス番号を探します。

2.  **クライアントを起動:**
    確認したデバイス番号を使って、クライアントを起動します。
    ```bash
    # 例: VB-CABLEが3番、出力がデフォルトの場合
    python client.py --input-device 3
    ```

3.  **終了方法:**
    クライアント、サーバー共に、実行しているターミナルで`Ctrl + C`を押すと安全に終了します。

## 4. クライアントのオプション

-   `--list-devices`: 利用可能なオーディオデバイスの一覧を表示して終了します。
-   `-i <番号>`, `--input-device <番号>`: 使用する入力デバイス（マイク）のインデックス番号を指定します。
-   `-o <番号>`, `--output-device <番号>`: 使用する出力デバイス（スピーカー）のインデックス番号を指定します。

## 5. トラブルシューティング

-   **「サーバーに接続できませんでした」と表示される:**
    -   サーバーは正常に起動していますか？
    -   VS Codeのポートフォワーディング（8080番）は正しく設定され、有効になっていますか？ 一度転送を停止し、再設定すると解決することがあります。
    -   `client.py`の`SERVER_IP`が`'localhost'`または`'127.0.0.1'`に設定されていますか？

-   **音声が聞こえない / 自分の声がそのまま返ってくる:**
    -   サーバー側で音声変換処理が正しく行われていますか？サーバーのログを確認してください。
    -   クライアントPCの音量ミキサーで「python」の音量がミュートになっていませんか？
    -   `client.py`で指定した出力デバイスは正しいですか？



# starganv2-vcでの変換
server_stargan.pyを起動
```bash
python server_stargan.py --config config.json
```
クライアントはclient_utterance.pyでok